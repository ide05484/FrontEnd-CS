# 9. ëª¨ë˜ ë¦¬ì•¡íŠ¸ ê°œë°œ ë„êµ¬ë¡œ ê°œë°œ ë° ë°°í¬ í™˜ê²½ êµ¬ì¶•í•˜ê¸°

## 9.1 Next.jsë¡œ ë¦¬ì•¡íŠ¸ ê°œë°œ í™˜ê²½ êµ¬ì¶•í•˜ê¸°

### 9.1.1 create-next-app ì—†ì´ í•˜ë‚˜ì”© êµ¬ì¶•í•˜ê¸°

- `npm init`ì„ ì‹¤í–‰í•˜ì—¬ `package.json`ì„ ë§Œë“œëŠ” CLI ì‹¤í–‰

  <details>
  <summary>npm init</summary>

  ```
  Â» npm init
  This utility will walk you through creating a package.json file.
  It only covers the most common items, and tries to guess sensible defaults.

  See `npm help init` for definitive documentation on these fields
  and exactly what they do.

  Use `npm install <pkg>` afterwards to install a package and
  save it as a dependency in the package.json file.

  Press ^C at any time to quit.
  package name: (my-app)
  version: (1.0.0)
  description:
  entry point: (index.js)
  test command:
  git repository:
  keywords:
  license: (ISC)
  About to write to /Users/yceffort/private/react-deep-dive-example/chapter7/my-app/package.json:

  {
    "name": "my-app",
    "version": "1.0.0",
    "description": "",
    "main": "index.js",
    "scripts": {
      "test": "echo \"Error: no test specified\" && exit 1"
    },
      "author": "yceffort",
      "license": "ISC"
  }

  Is this OK? (yes)
  ```

  </details>

- `react`, `react-dom`, `next` ì„¤ì¹˜

  ```
  Â» npm i react react-dom next
  ```

- `devDependencies`ì— í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
  ```
  Â» npm i @types/node @types/react @types/react-dom eslint eslint-config-next typescript --save-dev
  ```

### 9.1.2 tsconfig.json ì‘ì„±í•˜ê¸°

- `npm` ì„¤ì •ì„ `package.json`ì—ì„œ í•˜ëŠ” ê²ƒì°¨ëŸ¼ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì„¤ì •ì€ `tsconfig.json`ì— ê¸°ë¡í•œë‹¤
- `tsconfig.json`ì˜ `$schema` ì†ì„±ì€ `schemaStore`ì—ì„œ ì œê³µí•˜ëŠ” ì •ë³´ë¡œ, í•´ë‹¹ jsoníŒŒì¼ì´ ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëŠ”ì§€, ì–´ë–¤ í‚¤ì™€ ì–´ë–¤ ê°’ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ”ì§€ ì•Œë ¤ì¤€ë‹¤

  <details>
  <summary>tsconfig.json</summary>

  ```json
  {
    "$schema": "https://json.schemastore.org/tsconfig.json",
    "compilerOptions": {
      "target": "es5",
      "lib": ["dom", "dom.iterable", "esnext"],
      "allowJs": true,
      "skipLibCheck": true,
      "strict": true,
      "forceConsistentCasingInFileNames": true,
      "noEmit": true,
      "esModuleInterop": true,
      "module": "esnext",
      "moduleResolution": "node",
      "resolveJsonModule": true,
      "isolatedModules": true,
      "jsx": "preserve",
      "incremental": true,
      "baseUrl": "src",
      "paths": {
        "#pages/*": ["pages/*"],
        "#hooks/*": ["hooks/*"],
        "#types/*": ["types/*"],
        "#components/*": ["components/*"],
        "#utils/*": ["utils/*"]
      }
    },
    "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx"],
    "exclude": ["node_modules"]
  }
  ```

  </details>

- `tsconfig.json`ì˜ ì˜µì…˜
  - `compilerOptions`: íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì»´íŒŒì¼í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì˜µì…˜
    - `target`: íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ë³€í™˜ì„ ëª©í‘œë¡œ í•˜ëŠ” ì–¸ì–´ì˜ ë²„ì „
    - `strict`: íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì»´íŒŒì¼ëŸ¬ì˜ ì—„ê²© ëª¨ë“œë¥¼ ì œì–´
    - `noEmit`: ì»´íŒŒì¼ì„ í•˜ì§€ ì•Šê³ , íƒ€ì… ì²´í¬ë§Œ í•œë‹¤. `Next.js`ëŠ” `swc`ê°€ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì„ ì»´íŒŒì¼í•˜ë¯€ë¡œ êµ³ì´ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì»´íŒŒì¼í•  í•„ìš”ê°€ ì—†ë‹¤.
    - `module`: ëª¨ë“ˆ ì‹œìŠ¤í…œì„ ì„¤ì •í•œë‹¤. ëŒ€í‘œì ìœ¼ë¡œ `commonjs(require)`ì™€ `esnext(import)`ê°€ ìˆë‹¤.
    - `baseUrl`: ëª¨ë“ˆì„ ì°¾ì„ ë•Œ ê¸°ì¤€ì´ ë˜ëŠ” ë””ë ‰í„°ë¦¬ë¥¼ ì§€ì •í•œë‹¤. ì•„ë˜ì˜ `paths`ì™€ í•¨ê»˜ ì‚¬ìš©í•œë‹¤.
    - `paths`: ì¼ë°˜ì ìœ¼ë¡œ ëª¨ë“ˆì„ ë¶ˆëŸ¬ì˜¬ ë•Œ `'./'`ë‚˜ `'../'`ë¥¼ í™œìš©í•œ ìƒëŒ€ ê²½ë¡œë¥¼ í™œìš©í•˜ê²Œ ë˜ëŠ”ë°, `paths`ë¥¼ í™œìš©í•˜ì—¬ ë³„ì¹­(alias)ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤. ìœ„ì˜ ê²½ìš° `'#pages/main'`ì˜ ê²½ìš° `baseUrl`ê³¼ í•¨ê»˜ `'src/pages/main'`ì´ë¼ëŠ” ê²½ë¡œë¡œ í•´ì„ëœë‹¤.
  - `include`: íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì»´íŒŒì¼ ëŒ€ìƒì—ì„œ í¬í•¨ì‹œí‚¬ íŒŒì¼ ëª©ë¡
  - `exclude`: íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì»´íŒŒì¼ ëŒ€ìƒì—ì„œ ì œì™¸ì‹œí‚¬ íŒŒì¼ ëª©ë¡
- ì´ ë°–ì˜ ë‹¤ì–‘í•œ ì˜µì…˜ì€ [typescriptlang.org](https://www.typescriptlang.org/tsconfig) ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### 9.1.3 next.config.js ì‘ì„±í•˜ê¸°

- `Next.js` ì„¤ì •ì„ ìœ„í•œ `next.config.js`ë¥¼ ì‘ì„±í•œë‹¤
  <details>
  <summary>next.config.js</summary>

  ```js
  /** @type {import('next').NextConfig} */
  const nextConfig = {
    reactStrictMode: true,
    poweredByHeader: false,
    eslint: {
      ignoreDuringBuilds: true,
    },
  };

  module.exports = nextConfig;
  ```

  </details>

- `next.config.js`ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ì˜µì…˜ì€ [ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œ](https://github.com/vercel/next.js/blob/v12.3.1/packages/next/server/config-shared.ts)ë¥¼ ë°©ë¬¸í•´ ë³¸ì¸ì´ ì‚¬ìš© ì¤‘ì¸ ë²„ì „ì˜ íƒœê·¸ë¥¼ ì°¾ì•„ ë“¤ì–´ê°€ë©´ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
  <div>
      <img src="image/01_next.config.js.png" style="object-fit: contain" width=500>
  </div>

### 9.1.4 ESLintì™€ Prettier ì„¤ì •í•˜ê¸°

- ì¼ë°˜ì ì¸ `ESLint` ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ê°€ì¥ ì„¤ì¹˜ ë° ì„¤ì •ì´ ì‰¬ìš´ `@titicaca/eslint-config-triple`ì„ ì„¤ì¹˜í•´ ì‚¬ìš©í•œë‹¤.
  ```
  Â» npm i @titicaca/eslint-config-triple --save-dev
  ```
- `@titicaca/eslint-config-triple`ì— ëŒ€í•œ ì„¤ì •ì€ [ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œ](https://github.com/titicacadev/triple-config-kit#eslint-config-triple)ì— ì •ë¦¬ë˜ì–´ ìˆë‹¤.
- `eslint-config-next`ì™€ `eslint-config-triple`ì´ í•¨ê»˜ ì‘ë™í•˜ê²Œ í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë³„ë„ì˜ ì„¤ì •ì´ í•„ìš”í•˜ë‹¤

  ```js
  const path = require('path');

  const createConfig = require('@titicaca/eslint-config-triple/create-config');

  const { extends: extendConfigs, overrides } = createConfig({
    type: 'frontend',
    project: path.resolve(__dirname, './tsconfig.json'),
  });

  module.exports = {
    extends: [...extendConfigs, 'next/core-web-vitals'],
    overrides,
  };
  ```

### 9.1.5 ìŠ¤íƒ€ì¼ ì„¤ì •í•˜ê¸°

- ì´ í”„ë¡œì íŠ¸ ì˜ˆì‹œì—ì„œëŠ” `styled-component`ë¥¼ ì‚¬ìš©í•œë‹¤

  ```
  Â» npm i styled-components

  Â» npm i @types/styled-components --save-dev
  ```

- `swc`ì— `styled-components`ë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì„ ì•Œë¦¬ê¸° ìœ„í•´ `styledComponents: true`ë¥¼ `next.config.js`ì— ì¶”ê°€í•œë‹¤
- `pages/_document.tsx`ì˜ `Head`ì— `styled-components`ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ `ServerStyleSheet`ë¥¼ ì¶”ê°€í•œë‹¤(4.3ì ˆ 'Next.js í†ºì•„ë³´ê¸°' ì°¸ì¡°)
  <details>
  <summary>pages/_document.tsx</summary>

  ```js
  import Document, {
    Html,
    Head,
    Main,
    NextScript,
    DocumentContext,
    DocumentInitialProps,
  } from 'next/document';
  import { ServerStyleSheet } from 'styled-components';

  export default function MyDocument() {
    return (
      <Html lang="ko">
        <Head />
        <body>
          <Main />
          <NextScript />
        </body>
      </Html>
    );
  }

  MyDocument.getInitialProps = async (
    ctx: DocumentContext
  ): Promise<DocumentInitialProps> => {
    const sheet = new ServerStyleSheet();
    const originalRenderPage = ctx.renderPage;

    try {
      ctx.renderPage = () =>
        originalRenderPage({
          enhanceApp: (App) => (props) =>
            sheet.collectStyles(<App {...props} />),
        });

      const initialProps = await Document.getInitialProps(ctx);
      return {
        ...initialProps,
        styles: (
          <>
            {initialProps.styles}
            {sheet.getStyleElement()}
          </>
        ),
      };
    } finally {
      sheet.seal();
    }
  };
  ```

  </details>

### 9.1.6 ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ì‘ì„±

- `Next.js` ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í´ë” êµ¬ì¡°ëŠ” `src/pages`í•˜ë‹¨ì— ì‹¤ì œ í˜ì´ì§€ ë¼ìš°íŒ…ê³¼ ê´€ë ¨ëœ íŒŒì¼ì„ ê¸°ì¬í•´ì•¼ í•œë‹¤ëŠ” ì»¨ë²¤ì…˜ë§Œ ì§€í‚¤ë©´ ëœë‹¤
- [JSONPlaceholder](https://jsonplaceholder.typicode.com/) ì—ì„œ ì œê³µí•˜ëŠ” `todo API`ë¥¼ `getServerSideProps`ì—ì„œ ë¶ˆëŸ¬ì™€ ë Œë”ë§í•˜ëŠ” ê°„ë‹¨í•œ ì˜ˆì‹œ í”„ë¡œì íŠ¸ì˜ ê¸°ë³¸ì ì¸ í´ë” êµ¬ì¡°
  <details>
  <summary>í´ë” êµ¬ì¡° ì˜ˆì‹œ</summary>

  ```
  ğŸ“¦my-app
  â”£ ğŸ“‚src
  â”ƒ â”£ ğŸ“‚components
  â”ƒ â”ƒ â”£ ğŸ“‚common
  â”ƒ â”ƒ â”ƒ â”— ğŸ“œtitle.tsx
  â”ƒ â”ƒ â”— ğŸ“‚todo
  â”ƒ â”ƒ â”ƒ â”— ğŸ“œtodo.tsx
  â”ƒ â”£ ğŸ“‚hooks
  â”ƒ â”ƒ â”— ğŸ“œuseToggle.ts
  â”ƒ â”£ ğŸ“‚pages
  â”ƒ â”ƒ â”£ ğŸ“‚todos
  â”ƒ â”ƒ â”ƒ â”— ğŸ“œ[id].tsx
  â”ƒ â”ƒ â”£ ğŸ“œ_document.tsx
  â”ƒ â”ƒ â”— ğŸ“œindex.tsx
  â”ƒ â”£ ğŸ“‚types
  â”ƒ â”ƒ â”— ğŸ“œtodo.ts
  â”ƒ â”— ğŸ“‚utils
  â”ƒ â”ƒ â”— ğŸ“‚errors
  â”ƒ â”ƒ â”ƒ â”— ğŸ“œindex.ts
  â”£ ğŸ“œ.eslintrc.js
  â”£ ğŸ“œ.gitignore
  â”£ ğŸ“œ.prettierignore
  â”£ ğŸ“œ.prettierrc
  â”£ ğŸ“œnext-env.d.ts
  â”£ ğŸ“œnext.config.js
  â”£ ğŸ“œpackage-lock.json
  â”£ ğŸ“œpackage.json
  â”— ğŸ“œtsconfig.json
  ```

  </details>

- `package.json`ì— Next.js í”„ë¡œì íŠ¸ ì‹¤í–‰, ë¹Œë“œ, ë¦°íŠ¸ì™€ ê´€ë ¨ëœ ëª…ë ¹ì–´ë¥¼ ê¸°ì¬

  ```json
  {
    "//": "ìƒëµ",
    "scripts": {
      "dev": "next dev",
      "start": "next start",
      "build": "next build",
      "lint:es": "eslint '**/*.{js,ts,tsx}'",
      "lint:es:fix": "npm run lint:es -- --fix",
      "prettier": "prettier '**/*' --check",
      "prettier:fix": "prettier '**/*' --write"
    },
    "//": "ìƒëµ"
  }
  ```

- ì˜ˆì œ ì½”ë“œëŠ” [ê¹ƒí—ˆë¸Œ ì €ì¥ì†Œ](https://github.com/wikibook/react-deep-dive-example/tree/main/chapter9/zero-to-next)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤

### 9.1.7 ì •ë¦¬

- í”„ë¡œì íŠ¸ë¥¼ ìƒˆë¡œ ë§Œë“¤ ë•Œë§ˆë‹¤ ë˜‘ê°™ì€ ì„¤ì •ì„ ë°˜ë³µí•˜ì§€ ì•Šê¸° ìœ„í•œ ë°©ë²•

  1. <b>Template repository</b>

  - ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“  ë‹¤ìŒ, ê¹ƒí—ˆë¸Œì—ì„œ "Template repository" ì˜µì…˜ì„ ì²´í¬í•œë‹¤
      <div>
          <img src="image/02_Template repository_1.png" style="object-fit: contain" width=500>
      </div>
  - ë‹¤ë¥¸ ì €ì¥ì†Œë¥¼ ìƒì„±í•  ë•Œ í•´ë‹¹ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ ìƒì„±í•  ìˆ˜ ìˆë‹¤
      <div>
          <img src="image/03_Template repository_2.png" style="object-fit: contain" width=500>
      </div>
  - í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥ì†Œë¥¼ ìƒì„±í•˜ë©´ ì €ì¥ì†Œëª…ê³¼ í•¨ê»˜ â€˜generated fromâ€™ì´ë¼ëŠ” ë©”ì‹œì§€ë¡œ ì–´ë–¤ í…œí”Œë¦¿ì—ì„œ ë§Œë“¤ì–´ì§„ ì €ì¥ì†Œì¸ì§€ í™•ì¸í•  ìˆ˜ ìˆê²Œ ëœë‹¤
      <div>
          <img src="image/04_Template repository_3.png" style="object-fit: contain" width=500>
      </div>

  2. <b>create-\*\*\*-app</b>

  - `create-next-app`ì—ì„œ í•œ ë°œ ë” ë‚˜ì•„ê°€ ë‚˜ë§Œì˜ `create-***-app`ì„ ë§Œë“ ë‹¤
  - cli íŒ¨í‚¤ì§€ë¡œ ë§Œë“ ë‹¤ë©´ `create-next-app`ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì‚¬ìš©ìì˜ ì…ë ¥ì„ ë°›ì•„ ì„œë¡œ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤
  - ì•ì„  ë°©ë²•ë³´ë‹¤ í›¨ì”¬ ë” ì†ì´ ë§ì´ ê°€ì§€ë§Œ ì¡°ì§ ë‚´ì—ì„œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë¥¼ ì§€í–¥í•˜ê³  ìˆê³ , ì•ìœ¼ë¡œ ìƒì„±í•´ì•¼ í•  í”„ë¡œì íŠ¸ ë˜í•œ ë§ë‹¤ë©´ ì¶©ë¶„íˆ ê²€í† í•´ ë³¼ ë§Œí•˜ë‹¤
  - ë‹¤ìŒ ë‘ ì‚¬ì´íŠ¸ë¥¼ ì°¸ê³ í•´ `create-***-app`ì„ í•œë²ˆ ì§ì ‘ êµ¬í˜„í•´ ë³´ì
    - `create-next-app` ë‚´ë¶€ì˜ ì½”ë“œ: [create-next-appì˜ ì†ŒìŠ¤ì½”ë“œ](https://github.com/vercel/next.js/blob/canary/packages/create-next-app/index.ts)ë¥¼ ì‚´í´ë³´ë©´ ì•Œê² ì§€ë§Œ ì¼ë‹¨ í•˜ë‚˜ì˜ í…œí”Œë¦¿ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ ë‘” ë‹¤ìŒ, ì—¬ê¸°ì—ì„œ CLIë¡œ ì‚¬ìš©ìì˜ ì…ë ¥ì„ ë°›ì•„ ì»¤ìŠ¤í„°ë§ˆì´ì§•í•œ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.
    - [Creating a CLI tool with Node.js](https://blog.logrocket.com/creating-a-cli-tool-with-node-js/) : npmì„ ê¸°ë°˜ìœ¼ë¡œ CLI íŒ¨í‚¤ì§€ë¥¼ ë§Œë“œëŠ” ë°©ë²•ì„ ìƒì„¸í•˜ê²Œ ì„¤ëª…í•˜ê³  ìˆë‹¤.
